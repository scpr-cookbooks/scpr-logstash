filter {
  if [type] == "nginx" {
    grok {
      match => ["message", "%{NGINXACCESS}" ]
    }
    grok {
      match => ["request","%{URIPATH:request_path}(?:%{URIPARAM:request_params})?"]
    }
    date {
      match => [ "timestamp", "dd/MMM/yyyy:HH:mm:ss Z", "dd/MMM/yyyy:HH:mm:ss" ]
    }
    kv {
      source => "request_params"
      field_split => "&?"
      prefix => "q"
    }
  }
}